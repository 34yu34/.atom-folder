(function() {
  var CompositeDisposable;

  CompositeDisposable = require('atom').CompositeDisposable;

  module.exports = {
    activate: function(state) {
      this.subscriptions = new CompositeDisposable;
      this.subscriptions.add(atom.commands.add('atom-workspace', {
        'header-implementation:generate': (function(_this) {
          return function() {
            return _this.generate();
          };
        })(this)
      }));
      this.subscriptions.add(atom.commands.add('atom-workspace', {
        'header-implementation:add': (function(_this) {
          return function() {
            return _this.add();
          };
        })(this)
      }));
      this.FILE_NAMESPACE_END_PATTERN = /}\s+}/;
      this.FILE_NAME_PATTERN = /([\w]+)\.([h|cpp]+)/;
      this.CLASS_NAME_PATTERN = /(namespace|class)\s+(\w+)\s*{/g;
      return this.METHOD_PATTERN = /^\s*((?:(?:\s*const\s*)|(?:\s*static\s*)|(?:\s*virtual\s*)|(?:\s*volatile\s*)|(?:\s*friend\s*)){0,5}\s*\w+(?::{2}\w+)*(?:\s*?[&*]\s*?)*)??\s*([\w~]+)\s*(\(.*\))\s*?(\sconst)?\s*;/gm;
    },
    findPath: function(work) {
      work.headerPath = "";
      work.implementationPath = "";
      return atom.workspace.scan(this.FILE_NAME_PATTERN, function(file) {
        if (file.filePath.includes(work.classname + ".h")) {
          work.headerPath = file.filePath;
        }
        if (file.filePath.includes(work.classname + ".cpp")) {
          return work.implementationPath = file.filePath;
        }
      });
    },
    findClassName: function(work) {
      work.buffer.scan(this.CLASS_NAME_PATTERN, function(res) {
        work.namespace = res.match[1] === "namespace";
        return work.classname = res.match[2];
      });
      return work.editor.moveToEndOfLine();
    },
    findAllMethods: function(work) {
      var ctx;
      ctx = this;
      return work.buffer.scan(this.METHOD_PATTERN, function(res) {
        return ctx.addMethod(work, res);
      });
    },
    findMethodInRange: function(work, range) {
      var ctx;
      ctx = this;
      return work.editor.scanInBufferRange(this.METHOD_PATTERN, range, function(res) {
        return ctx.addMethod(work, res);
      });
    },
    addMethod: function(work, res) {
      var method;
      method = [];
      method.push((res.match[1] || "").replace("static ", "").replace(/\s{2,}/, " ") || "");
      method.push(res.match[2] + res.match[3] + (res.match[4] || ""));
      return work.methods.push(method);
    },
    readFile: function(work) {
      this.findClassName(work);
      return this.findAllMethods(work);
    },
    createFile: function(work) {
      return atom.workspace.open(work.implementationPath);
    },
    createHeadOfCpp: function(work) {
      work.editor.insertText("#include \"" + work.classname + ".h\"");
      work.editor.insertNewline();
      work.editor.insertNewline();
      work.editor.insertNewline();
      if (work.namespace) {
        work.editor.insertText("namespace " + work.classname);
        work.editor.insertNewline();
        work.editor.insertText("{");
        return work.editor.insertNewline();
      }
    },
    methodComment: function(work) {
      work.editor.insertText("/*" + "*".repeat(68));
      work.editor.insertNewline();
      work.editor.insertText("* Comment");
      work.editor.insertNewline();
      work.editor.insertText("*".repeat(68) + "*/");
      return work.editor.insertNewline();
    },
    methodName: function(work, method) {
      if (method[0]) {
        work.editor.insertText(method[0] + " ");
      }
      if (work.namespace) {
        work.editor.insertText("" + method[1]);
      } else {
        work.editor.insertText(work.classname + "::" + method[1]);
      }
      return work.editor.insertNewline();
    },
    methodBody: function(work) {
      work.editor.insertText("{");
      work.editor.insertNewline();
      work.editor.moveDown(1);
      return work.editor.insertNewline();
    },
    writeMethod: function(work, method) {
      this.methodComment(work);
      this.methodName(work, method);
      return this.methodBody(work);
    },
    writeAllMethods: function(work) {
      var ctx;
      ctx = this;
      return work.methods.forEach(function(method) {
        return ctx.writeMethod(work, method, ctx);
      });
    },
    writeNewCpp: function(work) {
      this.createHeadOfCpp(work);
      return this.writeAllMethods(work);
    },
    moveCursorToAppend: function(work) {
      if (work.namespace) {
        work.buffer.backwardsScan(this.FILE_NAMESPACE_END_PATTERN, function(res) {
          var point;
          point = res.range[0];
          return res.stop();
        });
        work.editor.setCursorBufferPosition(point);
        work.editor.moveRight(1);
        return work.editor.insertNewline();
      } else {
        return work.editor.moveToBottom();
      }
    },
    generateWork: function() {
      var buffer, editor, work;
      editor = atom.workspace.getActiveTextEditor();
      buffer = editor.getBuffer();
      work = {
        editor: editor,
        buffer: buffer,
        headerPath: "",
        implementationPath: "",
        classname: "",
        namespace: false,
        methods: []
      };
      return work;
    },
    changeEditor: function(work, editor) {
      work.editor = editor;
      return work.buffer = work.editor.getBuffer();
    },
    lineRange: function(work) {
      work.editor.moveToBeginningOfLine();
      work.editor.selectToEndOfLine();
      return work.editor.getSelectedBufferRange();
    },
    generate: function() {
      var ctx, work;
      work = this.generateWork();
      work.editor.save();
      this.readFile(work);
      work.headerPath = work.editor.getPath();
      work.implementationPath = work.headerPath.replace(".h", ".cpp");
      ctx = this;
      this.createFile(work).then(function(editor) {
        ctx.changeEditor(work, editor);
        return ctx.writeNewCpp(work);
      });
    },
    add: function() {
      var ctx, work;
      work = this.generateWork();
      work.editor.save;
      this.findClassName(work);
      ctx = this;
      this.findPath(work).then(function() {
        var range;
        range = ctx.lineRange(work);
        this.findMethodInRange(work, range);
        if (!work.methods.length) {
          return;
        }
        return ctx.createFile(work).then(function(editor) {
          ctx.changeEditor(work, editor);
          ctx.moveCursorToAppend(work);
          return ctx.writeMethod(work, work.methods[0]);
        });
      });
    }
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvYmlsbHkvZ2l0aHViL2hlYWRlci1pbXBsZW1lbnRhdGlvbi9saWIvaGVhZGVyLWltcGxlbWVudGF0aW9uLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLE1BQUE7O0VBQUMsc0JBQXVCLE9BQUEsQ0FBUSxNQUFSOztFQUV4QixNQUFNLENBQUMsT0FBUCxHQUVFO0lBQUEsUUFBQSxFQUFVLFNBQUMsS0FBRDtNQUVSLElBQUMsQ0FBQSxhQUFELEdBQWlCLElBQUk7TUFFckIsSUFBQyxDQUFBLGFBQWEsQ0FBQyxHQUFmLENBQW1CLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBZCxDQUFrQixnQkFBbEIsRUFBb0M7UUFBQSxnQ0FBQSxFQUFrQyxDQUFBLFNBQUEsS0FBQTtpQkFBQSxTQUFBO21CQUFHLEtBQUMsQ0FBQSxRQUFELENBQUE7VUFBSDtRQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBbEM7T0FBcEMsQ0FBbkI7TUFDQSxJQUFDLENBQUEsYUFBYSxDQUFDLEdBQWYsQ0FBbUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFkLENBQWtCLGdCQUFsQixFQUFvQztRQUFBLDJCQUFBLEVBQTZCLENBQUEsU0FBQSxLQUFBO2lCQUFBLFNBQUE7bUJBQUcsS0FBQyxDQUFBLEdBQUQsQ0FBQTtVQUFIO1FBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUE3QjtPQUFwQyxDQUFuQjtNQUVBLElBQUMsQ0FBQSwwQkFBRCxHQUE4QjtNQUM5QixJQUFDLENBQUEsaUJBQUQsR0FBcUI7TUFDckIsSUFBQyxDQUFBLGtCQUFELEdBQXNCO2FBQ3RCLElBQUMsQ0FBQSxjQUFELEdBQWtCO0lBVlYsQ0FBVjtJQW1EQSxRQUFBLEVBQVUsU0FBQyxJQUFEO01BQ1IsSUFBSSxDQUFDLFVBQUwsR0FBa0I7TUFDbEIsSUFBSSxDQUFDLGtCQUFMLEdBQTBCO0FBQzFCLGFBQU8sSUFBSSxDQUFDLFNBQVMsQ0FB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c2FibGV9ID0gcmVxdWlyZSAnYXRvbSdcblxubW9kdWxlLmV4cG9ydHMgPVxuXG4gIGFjdGl2YXRlOiAoc3RhdGUpIC0+XG4gICAgIyBFdmVudHMgc3Vic2NyaWJlZCB0byBpbiBhdG9tJ3Mgc3lzdGVtIGNhbiBiZSBlYXNpbHkgY2xlYW5lZCB1cCB3aXRoIGEgQ29tcG9zaXRlRGlzcG9zYWJsZVxuICAgIEBzdWJzY3JpcHRpb25zID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGVcbiAgICAjIFJlZ2lzdGVyIGNvbW1hbmQgdGhhdCB0b2dnbGVzIHRoaXMgdmlld1xuICAgIEBzdWJzY3JpcHRpb25zLmFkZCBhdG9tLmNvbW1hbmRzLmFkZCAnYXRvbS13b3Jrc3BhY2UnLCAnaGVhZGVyLWltcGxlbWVudGF0aW9uOmdlbmVyYXRlJzogPT4gQGdlbmVyYXRlKClcbiAgICBAc3Vic2NyaXB0aW9ucy5hZGQgYXRvbS5jb21tYW5kcy5hZGQgJ2F0b20td29ya3NwYWNlJywgJ2hlYWRlci1pbXBsZW1lbnRhdGlvbjphZGQnOiA9PiBAYWRkKClcbiAgICAjIFJlZ0V4IFBhdHRlcm5zXG4gICAgQEZJTEVfTkFNRVNQQUNFX0VORF9QQVRURVJOID0gL31cXHMrfS9cbiAgICBARklMRV9OQU1FX1BBVFRFUk4gPSAvKFtcXHddKylcXC4oW2h8Y3BwXSspL1xuICAgIEBDTEFTU19OQU1FX1BBVFRFUk4gPSAvKG5hbWVzcGFjZXxjbGFzcylcXHMrKFxcdyspXFxzKnsvZ1xuICAgIEBNRVRIT0RfUEFUVEVSTiA9IC8vL1xuICAgIF5cbiAgICBcXHMqXG4gICAgKFxuICAgICAgKD86XG4gICAgICAgICg/Olxccypjb25zdFxccyopfFxuICAgICAgICAoPzpcXHMqc3RhdGljXFxzKil8XG4gICAgICAgICg/Olxccyp2aXJ0dWFsXFxzKil8XG4gICAgICAgICg/Olxccyp2b2xhdGlsZVxccyopfFxuICAgICAgICAoPzpcXHMqZnJpZW5kXFxzKilcbiAgICAgICl7MCw1fVxuICAgICAgXFxzKlxuICAgICAgXFx3K1xuICAgICAgKD86XG4gICAgICAgIDp7Mn1cbiAgICAgICAgXFx3K1xuICAgICAgKSpcbiAgICAgICg/OlxuICAgICAgICBcXHMqP1xuICAgICAgICBbJipdXG4gICAgICAgIFxccyo/XG4gICAgICApKlxuICAgICk/P1xuICAgIFxccypcbiAgICAoW1xcd35dKylcbiAgICBcXHMqXG4gICAgKFxuICAgICAgXFwoXG4gICAgICAuKlxuICAgICAgXFwpXG4gICAgKVxuICAgIFxccyo/XG4gICAgKFxcc2NvbnN0KT9cbiAgICBcXHMqXG4gICAgO1xuICAgIC8vL2dtXG5cbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICAjIEZpbmQgdGhlIFBhcmggb2YgdGhlIHNvdXJjZSBmaWxlIGFuZCB0aGUgaGVhZGVycyBmaWxlXG4gICMgcmV0dXJuIGVtcHR5IGlmIG5vdGhpbmcgaXMgZm91bmRcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICBmaW5kUGF0aDogKHdvcmspIC0+XG4gICAgd29yay5oZWFkZXJQYXRoID0gXCJcIlxuICAgIHdvcmsuaW1wbGVtZW50YXRpb25QYXRoID0gXCJcIlxuICAgIHJldHVybiBhdG9tLndvcmtzcGFjZS5zY2FuIEBGSUxFX05BTUVfUEFUVEVSTiwgKGZpbGUpIC0+XG4gICAgICBpZiAoZmlsZS5maWxlUGF0aC5pbmNsdWRlcyhcIiN7d29yay5jbGFzc25hbWV9LmhcIikpXG4gICAgICAgIHdvcmsuaGVhZGVyUGF0aCA9IGZpbGUuZmlsZVBhdGhcbiAgICAgIGlmIChmaWxlLmZpbGVQYXRoLmluY2x1ZGVzKFwiI3t3b3JrLmNsYXNzbmFtZX0uY3BwXCIpKVxuICAgICAgICB3b3JrLmltcGxlbWVudGF0aW9uUGF0aCA9IGZpbGUuZmlsZVBhdGhcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICAjXHRGaW5kIHdldGhlciBpdCBpcyBhIG5hbWVzcGFjZSBvciBhIGNsYXNzZSBhbmQgYWRkIGl0cyBuYW1lIHRvIHdvcmtcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICBmaW5kQ2xhc3NOYW1lOiAod29yaykgLT5cbiAgICB3b3JrLmJ1ZmZlci5zY2FuIEBDTEFTU19OQU1FX1BBVFRFUk4sIChyZXMpIC0+XG4gICAgICB3b3JrLm5hbWVzcGFjZSA9IHJlcy5tYXRjaFsxXSA9PSBcIm5hbWVzcGFjZVwiXG4gICAgICB3b3JrLmNsYXNzbmFtZSA9IHJlcy5tYXRjaFsyXVxuICAgIHdvcmsuZWRpdG9yLm1vdmVUb0VuZE9mTGluZSgpXG4gICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbiAgI1x0RmluZCBhbGwgdGhlIG1ldGhvZHMgdGhhdCBtYXRjaCB0aGUgcGF0dGVybiBhbmQgYWRkIHRoZW1cbiAgIyBBZGQgdGhlIG1ldGhvZHMgdG8gd29yayBvYmplY3RcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICBmaW5kQWxsTWV0aG9kczogKHdvcmspIC0+XG4gICAgY3R4ID0gdGhpc1xuICAgIHdvcmsuYnVmZmVyLnNjYW4gQE1FVEhPRF9QQVRURVJOLCAocmVzKSAtPlxuICAgICAgY3R4LmFkZE1ldGhvZCh3b3JrLHJlcylcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICAjXHRGaW5kIGFsbCB0aGUgbWV0aG9kcyB3aXRoaW4gdGhlIGdpdmVuIHJhbmdlXG4gICMgQWRkIHRoZSBtZXRob2RzIHRvIHdvcmsgb2JqZWN0XG4gICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbiAgZmluZE1ldGhvZEluUmFuZ2U6ICh3b3JrLHJhbmdlKSAtPlxuICAgIGN0eCA9IHRoaXNcbiAgICB3b3JrLmVkaXRvci5zY2FuSW5CdWZmZXJSYW5nZSBATUVUSE9EX1BBVFRFUk4sIHJhbmdlLCAocmVzKSAtPlxuICAgICAgY3R4LmFkZE1ldGhvZCh3b3JrLHJlcylcblxuICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4gICNcdGFkZCBhIG1ldGhvZCB0byB0aGUgd29ya3NwYWNlIGZyb20gYSByZWdleCBtYXRjaFxuICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4gIGFkZE1ldGhvZDogKHdvcmsscmVzKSAtPlxuICAgIG1ldGhvZCA9IFtdXG4gICAgbWV0aG9kLnB1c2goKHJlcy5tYXRjaFsxXXx8XCJcIikucmVwbGFjZShcInN0YXRpYyBcIiwgXCJcIikucmVwbGFjZSgvXFxzezIsfS8sIFwiIFwiKSB8fCBcIlwiKVxuICAgIG1ldGhvZC5wdXNoKHJlcy5tYXRjaFsyXSArIHJlcy5tYXRjaFszXSArIChyZXMubWF0Y2hbNF18fFwiXCIpKVxuICAgIHdvcmsubWV0aG9kcy5wdXNoKG1ldGhvZClcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICAjXHRGaW5kIGJvdGggbmFtZSBhbmQgbWV0aG9kc1xuICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4gIHJlYWRGaWxlOiAod29yaykgLT5cbiAgICBAZmluZENsYXNzTmFtZSh3b3JrKVxuICAgIEBmaW5kQWxsTWV0aG9kcyh3b3JrKVxuICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4gICNcdFJldHVybiBhIHByb21pc2UgdG93YXJkIGEgbmV3IC5jcHAgZmlsZSBvcGVuXG4gICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbiAgY3JlYXRlRmlsZTogKHdvcmspIC0+XG4gICAgcmV0dXJuIGF0b20ud29ya3NwYWNlLm9wZW4od29yay5pbXBsZW1lbnRhdGlvblBhdGgpXG4gICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbiAgIyBXcml0ZSB0aGUgaGVhZCBvZiBhIC5jcHAgZmlsZSBkZXBlbmRpbmcgb24gaWZcbiAgIyBpdCdzIGEgbmFtZXNwYWNlIG9yIGEgY2xhc3NcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICBjcmVhdGVIZWFkT2ZDcHA6ICh3b3JrKSAtPlxuICAgIHdvcmsuZWRpdG9yLmluc2VydFRleHQoXCIjaW5jbHVkZSBcXFwiI3t3b3JrLmNsYXNzbmFtZX0uaFxcXCJcIilcbiAgICB3b3JrLmVkaXRvci5pbnNlcnROZXdsaW5lKClcbiAgICB3b3JrLmVkaXRvci5pbnNlcnROZXdsaW5lKClcbiAgICB3b3JrLmVkaXRvci5pbnNlcnROZXdsaW5lKClcbiAgICBpZiAod29yay5uYW1lc3BhY2UpXG4gICAgICB3b3JrLmVkaXRvci5pbnNlcnRUZXh0KFwibmFtZXNwYWNlICN7d29yay5jbGFzc25hbWV9XCIpXG4gICAgICB3b3JrLmVkaXRvci5pbnNlcnROZXdsaW5lKClcbiAgICAgIHdvcmsuZWRpdG9yLmluc2VydFRleHQoXCJ7XCIpXG4gICAgICB3b3JrLmVkaXRvci5pbnNlcnROZXdsaW5lKClcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICAjIEluc2VydCBhIGNvbW1lbnQgbGluZSBvbiB0b3Agb2YgYSBtZXRob2RcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICBtZXRob2RDb21tZW50OiAod29yaykgLT5cbiAgICB3b3JrLmVkaXRvci5pbnNlcnRUZXh0KFwiLypcIiArIFwiKlwiLnJlcGVhdCg2OCkpXG4gICAgd29yay5lZGl0b3IuaW5zZXJ0TmV3bGluZSgpXG4gICAgd29yay5lZGl0b3IuaW5zZXJ0VGV4dChcIiogQ29tbWVudFwiKVxuICAgIHdvcmsuZWRpdG9yLmluc2VydE5ld2xpbmUoKVxuICAgIHdvcmsuZWRpdG9yLmluc2VydFRleHQoIFwiKlwiLnJlcGVhdCg2OCkrIFwiKi9cIilcbiAgICB3b3JrLmVkaXRvci5pbnNlcnROZXdsaW5lKClcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICAjXHRXcml0ZSB0aGUgbWV0aG9kIG5hbWVcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICBtZXRob2ROYW1lOiAod29yayxtZXRob2QpIC0+XG4gICAgaWYgKG1ldGhvZFswXSlcbiAgICAgIHdvcmsuZWRpdG9yLmluc2VydFRleHQoXCIje21ldGhvZFswXX0gXCIpXG4gICAgaWYgKHdvcmsubmFtZXNwYWNlKVxuICAgICAgd29yay5lZGl0b3IuaW5zZXJ0VGV4dChcIiN7bWV0aG9kWzFdfVwiIClcbiAgICBlbHNlXG4gICAgICB3b3JrLmVkaXRvci5pbnNlcnRUZXh0KFwiI3t3b3JrLmNsYXNzbmFtZX06OiN7bWV0aG9kWzFdfVwiKVxuICAgIHdvcmsuZWRpdG9yLmluc2VydE5ld2xpbmUoKVxuICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4gICNcdFdyaXRlIHRoZSBib2R5IG9mIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBhIG1ldGhvZFxuICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4gIG1ldGhvZEJvZHk6ICh3b3JrKSAtPlxuICAgIHdvcmsuZWRpdG9yLmluc2VydFRleHQoXCJ7XCIpXG4gICAgd29yay5lZGl0b3IuaW5zZXJ0TmV3bGluZSgpXG4gICAgd29yay5lZGl0b3IubW92ZURvd24oMSlcbiAgICB3b3JrLmVkaXRvci5pbnNlcnROZXdsaW5lKClcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICAjXHRBZGQgYSBtZXRob2QgYXQgdGhlIGN1cnNvciBwb3NpdGlvblxuICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4gIHdyaXRlTWV0aG9kOiAod29yayxtZXRob2QpIC0+XG4gICAgQG1ldGhvZENvbW1lbnQod29yaylcbiAgICBAbWV0aG9kTmFtZSh3b3JrLG1ldGhvZClcbiAgICBAbWV0aG9kQm9keSh3b3JrKVxuICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4gICNcdENyZWF0ZSBhbGwgdGhlIG1ldGhvZHMgYmFjayB0byBiYWNrXG4gICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbiAgd3JpdGVBbGxNZXRob2RzOiAod29yaykgLT5cbiAgICBjdHggPSB0aGlzXG4gICAgd29yay5tZXRob2RzLmZvckVhY2ggKG1ldGhvZCkgLT5cbiAgICAgIGN0eC53cml0ZU1ldGhvZCh3b3JrLG1ldGhvZCxjdHgpXG4gICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbiAgI1x0V3JpdGUgdGhlIHdob2xlIGZpbGUgLmNwcFxuICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4gIHdyaXRlTmV3Q3BwOiAod29yaykgLT5cbiAgICBAY3JlYXRlSGVhZE9mQ3BwKHdvcmspXG4gICAgQHdyaXRlQWxsTWV0aG9kcyh3b3JrKVxuICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4gICNcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICBtb3ZlQ3Vyc29yVG9BcHBlbmQ6ICh3b3JrKSAtPlxuICAgIGlmICh3b3JrLm5hbWVzcGFjZSlcbiAgICAgIHdvcmsuYnVmZmVyLmJhY2t3YXJkc1NjYW4gQEZJTEVfTkFNRVNQQUNFX0VORF9QQVRURVJOLCAocmVzKSAtPlxuICAgICAgICBwb2ludCA9IHJlcy5yYW5nZVswXVxuICAgICAgICByZXMuc3RvcCgpXG4gICAgICB3b3JrLmVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihwb2ludClcbiAgICAgIHdvcmsuZWRpdG9yLm1vdmVSaWdodCgxKVxuICAgICAgd29yay5lZGl0b3IuaW5zZXJ0TmV3bGluZSgpXG4gICAgZWxzZVxuICAgICAgd29yay5lZGl0b3IubW92ZVRvQm90dG9tKClcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICAjXHRnZW5lcmF0ZSBhIHdvcmsgb2JqZWN0XG4gICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbiAgZ2VuZXJhdGVXb3JrOiAtPlxuICAgIGVkaXRvciA9IGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKVxuICAgIGJ1ZmZlciA9IGVkaXRvci5nZXRCdWZmZXIoKVxuICAgIHdvcmsgPVxuICAgICAge1xuICAgICAgICBlZGl0b3IsXG4gICAgICAgIGJ1ZmZlcixcbiAgICAgICAgaGVhZGVyUGF0aCA6IFwiXCJcbiAgICAgICAgaW1wbGVtZW50YXRpb25QYXRoIDogXCJcIlxuICAgICAgICBjbGFzc25hbWUgOiBcIlwiXG4gICAgICAgIG5hbWVzcGFjZSA6IGZhbHNlXG4gICAgICAgIG1ldGhvZHMgOiBbXVxuICAgICAgfVxuICAgIHJldHVybiB3b3JrXG4gIGNoYW5nZUVkaXRvcjogKHdvcmssZWRpdG9yKSAtPlxuICAgIHdvcmsuZWRpdG9yID0gZWRpdG9yXG4gICAgd29yay5idWZmZXIgPSB3b3JrLmVkaXRvci5nZXRCdWZmZXIoKVxuICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4gICNcdFJldHVybiB0aGUgcmFuZ2Ugb2YgdGhlIGxpbmUgaW4gYnVmZmVyIGNvb3JkXG4gICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbiAgbGluZVJhbmdlOiAod29yaykgLT5cbiAgICB3b3JrLmVkaXRvci5tb3ZlVG9CZWdpbm5pbmdPZkxpbmUoKVxuICAgIHdvcmsuZWRpdG9yLnNlbGVjdFRvRW5kT2ZMaW5lKClcbiAgICByZXR1cm4gd29yay5lZGl0b3IuZ2V0U2VsZWN0ZWRCdWZmZXJSYW5nZSgpXG4gICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbiAgI1x0UmVhZCB0aGUgaGVhZGVyIGZpbGVzIHlvdSBhcmUgaW4gYW5kIGdlbmVyYXRlIGEgLmNwcFxuICAjIGluIHRoZSBzYW1lIHBhdGhcbiAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuICBnZW5lcmF0ZTogLT5cbiAgICB3b3JrID0gQGdlbmVyYXRlV29yaygpXG4gICAgd29yay5lZGl0b3Iuc2F2ZSgpXG4gICAgQHJlYWRGaWxlKHdvcmspXG4gICAgd29yay5oZWFkZXJQYXRoID0gd29yay5lZGl0b3IuZ2V0UGF0aCgpXG4gICAgd29yay5pbXBsZW1lbnRhdGlvblBhdGggPSB3b3JrLmhlYWRlclBhdGgucmVwbGFjZShcIi5oXCIsXCIuY3BwXCIpXG4gICAgY3R4ID0gdGhpc1xuICAgIEBjcmVhdGVGaWxlKHdvcmspLnRoZW4gKGVkaXRvcikgLT5cbiAgICAgIGN0eC5jaGFuZ2VFZGl0b3Iod29yayxlZGl0b3IpXG4gICAgICBjdHgud3JpdGVOZXdDcHAod29yaylcbiAgICByZXR1cm5cblxuICBhZGQ6IC0+XG4gICAgd29yayA9IEBnZW5lcmF0ZVdvcmsoKVxuICAgIHdvcmsuZWRpdG9yLnNhdmVcbiAgICBAZmluZENsYXNzTmFtZSh3b3JrKVxuICAgIGN0eCA9IHRoaXNcbiAgICBAZmluZFBhdGgod29yaykudGhlbiAtPlxuICAgICAgcmFuZ2UgPSBjdHgubGluZVJhbmdlKHdvcmspXG4gICAgICBAZmluZE1ldGhvZEluUmFuZ2Uod29yayxyYW5nZSlcbiAgICAgIHVubGVzcyB3b3JrLm1ldGhvZHMubGVuZ3RoXG4gICAgICAgIHJldHVyblxuICAgICAgY3R4LmNyZWF0ZUZpbGUod29yaykudGhlbiAoZWRpdG9yKSAtPlxuICAgICAgICBjdHguY2hhbmdlRWRpdG9yKHdvcmssZWRpdG9yKVxuICAgICAgICBjdHgubW92ZUN1cnNvclRvQXBwZW5kKHdvcmspXG4gICAgICAgIGN0eC53cml0ZU1ldGhvZCh3b3JrLHdvcmsubWV0aG9kc1swXSlcbiAgICByZXR1cm5cbiJdfQ==
